#!/usr/bin/env bash

#
#   Main menu refactored to use the fuzzel frontend. Full featured

#   Made at and for omarchy-mac
#   (Omarchi fork for AS Macs, link in the readme)
#   For usage instead of walker, which
#   functional is cropped for aarch64

#   TayoWrld
#    .-|:"""":""""""'''"""":|-.
#   :  |'----'-------------'|  :
#   :  |                    |  :
#   :  |                    |  :
#   :  |               mga  |  :
#   :  | .----------------. |  :
#   :  |[ zip:          [i]]|  :
#   :  |[------------------]|  :
#   :  |[                  ]|  :
#   :  |[                  ]|  :
#   :  |[.....        PC100]|  :
#   :  |[::::::..     wrld ]|  :
#   :  |""""""""""""""""""|  :
#   '--'--------------------'--'
#
#   ALWAYS: View readme for details
#

set -euo pipefail

export PATH="$HOME/.local/share/omarchy/bin:$PATH"

# ---- fuzzel-only launcher glue ------------------------------------------------

require_fuzzel() {
  if ! command -v fuzzel >/dev/null 2>&1; then
    notify-send "Omarchy menu" "Install fuzzel before use this utility. Try: pacman -S fuzzel"
    echo "fuzzel not found; please install 'fuzzel'." >&2
    exit 127
  fi
}

# Argument of type $extra can contain flags, like: "-w 350" (width), otherwise ignore.
# preselect â€” first-glue stroke.
menu() {
  local prompt="$1"
  local options="$2"
  local extra="${3:-}"
  local preselect="${4:-}"

  require_fuzzel

  # width options processing from $extra
  local width=""
  if [[ -n "$extra" ]]; then
    # simple "-w NUMBER"
    if [[ "$extra" =~ -w[[:space:]]*([0-9]+) ]]; then
      width="${BASH_REMATCH[1]}"
    fi
  fi

  # -a emulation (walker relative)
  local list="$options"
  if [[ -n "$preselect" ]]; then
    # exctly strokes matching
    local first
    first="$(printf "%s\n" "$options" | awk -v target="$preselect" 'BEGIN{found=0} { if(!found && $0==target){ print; found=1; } }')"
    if [[ -n "$first" ]]; then
      local rest
      rest="$(printf "%s\n" "$options" | awk -v target="$preselect" '$0!=target')"
      list="$first"$'\n'"$rest"
    fi
  fi

  # Building fuzzel flags
  # --dmenu â€” get from stdin and selected to stdout
  # --prompt â€” request header
  # --width - window's width (if empty, fuzzel would set default)
  local args=(--dmenu --width 20 --placeholder "Go...")

  # Start. Fuzzel returns empty stroke on esc/cancel
  local choice
  choice="$(printf "%s\n" "$list" | fuzzel "${args[@]}" || true)"
  printf "%s" "${choice:-CNCLD}"
}

# Runners. Saved as they were in original. That's all you want to know, believe me.
terminal() { alacritty --class=Omarchy -e "$@"; }
present_terminal() { omarchy-launch-floating-terminal-with-presentation "$1"; }
open_in_editor() {
  notify-send "Editing config file" "$1"
  omarchy-launch-editor "$1"
}

install() { present_terminal "echo 'Installing $1...'; sudo pacman -S --noconfirm $2"; }
install_and_launch() { present_terminal "echo 'Installing $1...'; sudo pacman -S --noconfirm $2 && setsid gtk-launch $3"; }
install_font() { present_terminal "echo 'Installing $1...'; sudo pacman -S --noconfirm --needed $2 && sleep 2 && omarchy-font-set '$3'"; }
install_terminal() { present_terminal "omarchy-install-terminal $1"; }
aur_install() { present_terminal "echo 'Installing $1 from AUR...'; yay -S --noconfirm $2"; }
aur_install_and_launch() { present_terminal "echo 'Installing $1 from AUR...'; yay -S --noconfirm $2 && setsid gtk-launch $3"; }

# ---- Backs logic -------------------------------------------
BACK_TO_EXIT=false
back_to() {
  local parent_menu="${1:-}"
  if [[ "$BACK_TO_EXIT" == "true" ]]; then
    exit 0
  elif [[ -n "$parent_menu" ]]; then
    "$parent_menu"
  else
    show_main_menu
  fi
}

# ---- Menu list (no changes, brootha, why you still read it? DHH really knows it better, we got no need to dive there.
# You can literally just star this repo and stop spending your time reading code. Don't be like me, go touch the grass ) -----

show_learn_menu() {
  case "$(menu "Learn" $'ï„œ  Keybindings\nï…  Omarchy\nï™  Hyprland\nó°£‡  Arch\nîš®  Neovim\nó±†ƒ  Bash')" in
  *Keybindings*) omarchy-menu-keybindings ;;
  *Omarchy*) omarchy-launch-webapp "https://learn.omacom.io/2/the-omarchy-manual" ;;
  *Hyprland*) omarchy-launch-webapp "https://wiki.hypr.land/" ;;
  *Arch*) omarchy-launch-webapp "https://wiki.archlinux.org/title/Main_page" ;;
  *Bash*) omarchy-launch-webapp "https://devhints.io/bash" ;;
  *Neovim*) omarchy-launch-webapp "https://www.lazyvim.org/keymaps" ;;
  *) show_main_menu ;;
  esac
}

show_trigger_menu() {
  case "$(menu "Trigger" $'ï€°  Capture\nï”  Share\nó°”  Toggle')" in
  *Capture*) show_capture_menu ;;
  *Share*) show_share_menu ;;
  *Toggle*) show_toggle_menu ;;
  *) show_main_menu ;;
  esac
}

show_capture_menu() {
  case "$(menu "Capture" $'ï€°  Screenshot\nï€½  Screenrecord\nó°ƒ‰  Color')" in
  *Screenshot*) show_screenshot_menu ;;
  *Screenrecord*) show_screenrecord_menu ;;
  *Color*) pkill hyprpicker || hyprpicker -a ;;
  *) show_trigger_menu ;;
  esac
}

show_screenshot_menu() {
  case "$(menu "Screenshot" $'ï€°  Region\nï€°  Window\nï€°  Display')" in
  *Region*) omarchy-cmd-screenshot ;;
  *Window*) omarchy-cmd-screenshot window ;;
  *Display*) omarchy-cmd-screenshot output ;;
  *) show_capture_menu ;;
  esac
}

get_webcam_list() {
  v4l2-ctl --list-devices 2>/dev/null | while IFS= read -r line; do
    if [[ "$line" != $'\t'* && -n "$line" ]]; then
      local name="$line"
      IFS= read -r device || break
      device=$(echo "$device" | tr -d '\t' | head -1)
      [[ -n "$device" ]] && echo "$device  $name"
    fi
  done
}

show_webcam_select_menu() {
  local devices=$(get_webcam_list)
  local count=$(echo "$devices" | grep -c . 2>/dev/null || echo 0)

  if [[ -z "$devices" || "$count" -eq 0 ]]; then
    notify-send "No webcam devices found" -u critical -t 3000
    return 1
  fi

  if [[ "$count" -eq 1 ]]; then
    echo "$devices" | awk '{print $1}'
  else
    menu "Select Webcam" "$devices" | awk '{print $1}'
  fi
}

show_screenrecord_menu() {
  case "$(menu \"Screenrecord\" $'\uf03d  Region\\n\uf03d  Region + Audio\\n\uf03d  Display\\n\uf03d  Display + Audio')" in
  *"Region + Audio"*) omarchy-cmd-screenrecord region audio ;;
  *Region*) omarchy-cmd-screenrecord ;;
  *"Display + Audio"*) omarchy-cmd-screenrecord output audio ;;
  *Display*) omarchy-cmd-screenrecord output ;;
  *) show_capture_menu ;;

  esac
}

show_share_menu() {
  case "$(menu "Share" $'ï¿  Clipboard\nî©»  File \nï„”  Folder')" in
  *Clipboard*) terminal bash -c "omarchy-cmd-share clipboard" ;;
  *File*) terminal bash -c "omarchy-cmd-share file" ;;
  *Folder*) terminal bash -c "omarchy-cmd-share folder" ;;
  *) back_to show_trigger_menu ;;
  esac
}

show_toggle_menu() {
  case "$(menu "Toggle" $'ó±„„  Screensaver\nó°”  Nightlight\nó±«–  Idle Lock\nó°œ  Top Bar')" in
  *Screensaver*) omarchy-toggle-screensaver ;;
  *Nightlight*) omarchy-toggle-nightlight ;;
  *Idle*) omarchy-toggle-idle ;;
  *Bar*) omarchy-toggle-waybar ;;
  *) show_trigger_menu ;;
  esac
}

show_style_menu() {
  case "$(menu "Style" $'ó°¸Œ  Theme\nî™™  Font\nï€¾  Background\nï™  Hyprland\nó±„„  Screensaver\nî©´  About')" in
  *Theme*) show_theme_menu ;;
  *Font*) show_font_menu ;;
  *Background*) omarchy-theme-bg-next ;;
  *Hyprland*) open_in_editor ~/.config/hypr/looknfeel.conf ;;
  *Screensaver*) open_in_editor ~/.config/omarchy/branding/screensaver.txt ;;
  *About*) open_in_editor ~/.config/omarchy/branding/about.txt ;;
  *) show_main_menu ;;
  esac
}

show_theme_menu() {
  local theme
  theme="$(menu "Theme" "$(omarchy-theme-list)" "" "$(omarchy-theme-current)")"
  if [[ "$theme" == "CNCLD" || -z "$theme" ]]; then
    back_to show_style_menu
  else
    omarchy-theme-set "$theme"
  fi
}

show_font_menu() {
  local theme
  theme="$(menu "Font" "$(omarchy-font-list)" "-w 80" "$(omarchy-font-current)")"
  if [[ "$theme" == "CNCLD" || -z "$theme" ]]; then
    back_to show_style_menu
  else
    omarchy-font-set "$theme"
  fi
}

show_setup_menu() {
  local options="î˜¸  Audio"
  options+=$'\n'"ï‡«  Wifi"
  options+=$'\n'"ó°‚¯  Bluetooth"
  options+=$'\n'"ó±‹  Power Profile"
  options+=$'\n'"ó°¹  Monitors"

  [[ -f ~/.config/hypr/bindings.conf ]] && options+=$'\n'"ï„œ  Keybindings"
  [[ -f ~/.config/hypr/input.conf ]] && options+=$'\n'"î¾º  Input"
  options+=$'\n'"  Keyboard Layout"

  options+=$'\n'"ï’‰  Defaults"
  options+=$'\n'"ó°±”  DNS"
  options+=$'\n'"î¬‘  Security"
  options+=$'\n'"î˜•  Config"

  case "$(menu "Setup" "$options")" in
  *Audio*) $TERMINAL --class=Wiremix -e wiremix ;;
  *Wifi*)
    rfkill unblock wifi
    omarchy-launch-wifi
    ;;
  *Bluetooth*)
    rfkill unblock bluetooth
    blueberry
    ;;
  *Power*) show_setup_power_menu ;;
  *Monitors*) open_in_editor ~/.config/hypr/monitors.conf ;;
  *Keybindings*) open_in_editor ~/.config/hypr/bindings.conf ;;
  *Input*) open_in_editor ~/.config/hypr/input.conf ;;
  *Keyboard*) present_terminal omarchy-setup-keyboard ;;
  *Defaults*) open_in_editor ~/.config/uwsm/default ;;
  *DNS*) present_terminal omarchy-setup-dns ;;
  *Security*) show_setup_security_menu ;;
  *Config*) show_setup_config_menu ;;
  *) show_main_menu ;;
  esac
}

show_setup_power_menu() {
  local profile
  profile="$(menu "Power Profile" "$(omarchy-powerprofiles-list)" "" "$(powerprofilesctl get)")"
  if [[ "$profile" == "CNCLD" || -z "$profile" ]]; then
    back_to show_setup_menu
  else
    powerprofilesctl set "$profile"
  fi
}

show_setup_config_menu() {
  case "$(menu "Setup" $'ï™  Hyprland\nï™  Hypridle\nï™  Hyprlock\nï™  Hyprsunset\nï  Swayosd\nó°Œ§  Walker\nó°œ  Waybar\nó°…  XCompose')" in
  *Hyprland*) open_in_editor ~/.config/hypr/hyprland.conf ;;
  *Hypridle*) open_in_editor ~/.config/hypr/hypridle.conf && omarchy-restart-hypridle ;;
  *Hyprlock*) open_in_editor ~/.config/hypr/hyprlock.conf ;;
  *Hyprsunset*) open_in_editor ~/.config/hypr/hyprsunset.conf && omarchy-restart-hyprsunset ;;
  *Swayosd*) open_in_editor ~/.config/swayosd/config.toml && omarchy-restart-swayosd ;;
  *Walker*) open_in_editor ~/.config/walker/config.toml && omarchy-restart-walker ;;
  *Waybar*) open_in_editor ~/.config/waybar/config.jsonc && omarchy-restart-waybar ;;
  *XCompose*) open_in_editor ~/.XCompose && omarchy-restart-xcompose ;;
  *) show_main_menu ;;
  esac
}

show_setup_security_menu() {
  case "$(menu "Setup" $'ó°ˆ·  Fingerprint\nî¬‘  Fido2')" in
  *Fingerprint*) present_terminal omarchy-setup-fingerprint ;;
  *Fido2*) present_terminal omarchy-setup-fido2 ;;
  *) show_setup_menu ;;
  esac
}

show_install_menu() {
  case "$(menu "Install" $'ó°£‡  Package\nó°£‡  AUR\nï’‡  AppImage\nï‰¨  Web App\nï’‰  TUI\nï’‡  Service\nî¯  Style\nó°µ®  Development\nï…œ  Editor\nï’‰  Terminal\nó±š¤  AI\nï„›  Gaming')" in
  *Package*) terminal omarchy-pkg-install ;;
  *AUR*) terminal omarchy-pkg-aur-install ;;
  *AppImage*) terminal omarchy-appimage-install ;;
  *Web*) present_terminal omarchy-webapp-install ;;
  *TUI*) present_terminal omarchy-tui-install ;;
  *Service*) show_install_service_menu ;;
  *Style*) show_install_style_menu ;;
  *Development*) show_install_development_menu ;;
  *Editor*) show_install_editor_menu ;;
  *Terminal*) show_install_terminal_menu ;;
  *AI*) show_install_ai_menu ;;
  *Gaming*) show_install_gaming_menu ;;
  *) show_main_menu ;;
  esac
}

show_install_service_menu() {
  case "$(menu "Install" $'îœ‡  Dropbox\nï’‡  Tailscale\nó°Ÿµ  Bitwarden\nîŸ°  Chromium Account')" in
  *Dropbox*) aur_install "Dropbox" "dropbox" "dropbox-cli" "nautilus-dropbox" ;;
  *Tailscale*) aur_install "Tailscale" "tailscale" ;;
  *Bitwarden*) install_and_launch "Bitwarden" "bitwarden bitwarden-cli" "bitwarden" ;;
  *Chromium*) present_terminal omarchy-install-chromium-google-account ;;
  *) show_install_menu ;;
  esac
}

show_install_editor_menu() {
  case "$(menu "Install" $'î£š  VSCode\nï…œ  Cursor\nï…œ  Zed\nï…œ  Sublime Text\nï…œ  Helix\nï…œ  Emacs')" in
  *VSCode*) install_and_launch "VSCode" "visual-studio-code-bin" "code" ;;
  *Cursor*) install_and_launch "Cursor" "cursor-bin" "cursor" ;;
  *Zed*) install_and_launch "Zed" "zed" "dev.zed.Zed" ;;
  *Sublime*) aur_install_and_launch "Sublime Text" "sublime-text-4" "sublime_text" ;;
  *Helix*) install "Helix" "helix" ;;
  *Emacs*) install "Emacs" "emacs-wayland" && systemctl --user enable --now emacs.service ;;
  *) show_install_menu ;;
  esac
}

show_install_terminal_menu() {
  case "$(menu "Install" $'ï’‰  Alacritty\nï’‰  Ghostty\nï’‰  Kitty')" in
  *Alacritty*) install_terminal "alacritty" ;;
  *Ghostty*) aur_install "ghostty-git" ;;
  *Kitty*) install_terminal "kitty" ;;
  *) show_install_menu ;;
  esac
}

show_install_ai_menu() {
  local ollama_pkg
  ollama_pkg=$(
    (command -v nvidia-smi &>/dev/null && echo ollama-cuda) ||
      (command -v rocminfo &>/dev/null && echo ollama-rocm) ||
      echo ollama
  )

  case "$(menu "Install" $'ó±š¤  Claude Code\nó±š¤  Gemini [AUR]\nó±š¤  OpenAI Codex [AUR]\nó±š¤  LM Studio\nó±š¤  Ollama\nó±š¤  Crush\nó±š¤  opencode [AUR]')" in
  *Claude*) install "Claude Code" "claude-code" ;;
  *OpenAI*) aur_install "OpenAI Codex" "openai-codex-bin" ;;
  *Gemini*) aur_install "Gemini" "gemini-cli" ;;
  *Studio*) install "LM Studio" "lmstudio" ;;
  *Ollama*) install "Ollama" "$ollama_pkg" ;;
  *Crush*) install "Crush" "crush-bin" ;;
  *opencode*) aur_install "opencode" "opencode-bin" ;;
  *) show_install_menu ;;
  esac
}

show_install_gaming_menu() {
  case "$(menu "Install" $'ï†¶  Steam\nï„›  RetroArch [AUR]\nó°³  Minecraft')" in
  *Steam*) present_terminal omarchy-install-steam ;;
  *RetroArch*) aur_install_and_launch "RetroArch" "retroarch retroarch-assets libretro libretro-fbneo" "com.libretro.RetroArch.desktop" ;;
  *Minecraft*) aur_install_and_launch "Minecraft [AUR]" "minecraft-launcher" "minecraft-launcher" ;;
  *) show_install_menu ;;
  esac
}

show_install_style_menu() {
  case "$(menu "Install" $'ó°¸Œ  Theme\nï€¾  Background\nî™™  Font')" in
  *Theme*) present_terminal omarchy-theme-install ;;
  *Background*) nautilus ~/.config/omarchy/current/theme/backgrounds ;;
  *Font*) show_install_font_menu ;;
  *) show_install_menu ;;
  esac
}

show_install_font_menu() {
  case "$(menu "Install" $'î™™  Meslo LG Mono\nî™™  Fira Code\nî™™  Victor Code\nî™™  Bistream Vera Mono' "-w 350")" in
  *Meslo*) install_font "Meslo LG Mono" "ttf-meslo-nerd" "MesloLGL Nerd Font" ;;
  *Fira*) install_font "Fira Code" "ttf-firacode-nerd" "FiraCode Nerd Font" ;;
  *Victor*) install_font "Victor Code" "ttf-victor-mono-nerd" "VictorMono Nerd Font" ;;
  *Bistream*) install_font "Bistream Vera Code" "ttf-bitstream-vera-mono-nerd" "BitstromWera Nerd Font" ;;
  *) show_install_menu ;;
  esac
}

show_install_development_menu() {
  case "$(menu "Install" $'ó°«  Ruby on Rails\nïˆŸ  Docker DB\nî  JavaScript\nî˜§  Go\nîœ½  PHP\nîœ¼  Python\nî˜­  Elixir\nî£¯  Zig\nî¨  Rust\nîœ¸  Java\nî¿  .NET\nî¡  OCaml\nî¨  Clojure')" in
  *Rails*) present_terminal "omarchy-install-dev-env ruby" ;;
  *Docker*) present_terminal omarchy-install-docker-dbs ;;
  *JavaScript*) show_install_javascript_menu ;;
  *Go*) present_terminal "omarchy-install-dev-env go" ;;
  *PHP*) show_install_php_menu ;;
  *Python*) present_terminal "omarchy-install-dev-env python" ;;
  *Elixir*) show_install_elixir_menu ;;
  *Zig*) present_terminal "omarchy-install-dev-env zig" ;;
  *Rust*) present_terminal "omarchy-install-dev-env rust" ;;
  *Java*) present_terminal "omarchy-install-dev-env java" ;;
  *NET*) present_terminal "omarchy-install-dev-env dotnet" ;;
  *OCaml*) present_terminal "omarchy-install-dev-env ocaml" ;;
  *Clojure*) present_terminal "omarchy-install-dev-env clojure" ;;
  *) show_install_menu ;;
  esac
}

show_install_javascript_menu() {
  case "$(menu "Install" $'î´  Node.js\nî¯  Bun\nîŸ€  Deno')" in
  *Node*) present_terminal "omarchy-install-dev-env node" ;;
  *Bun*) present_terminal "omarchy-install-dev-env bun" ;;
  *Deno*) present_terminal "omarchy-install-dev-env deno" ;;
  *) show_install_development_menu ;;
  esac
}

show_install_php_menu() {
  case "$(menu "Install" $'îœ½  PHP\nîœ¿  Laravel\nî—  Symfony')" in
  *PHP*) present_terminal "omarchy-install-dev-env php" ;;
  *Laravel*) present_terminal "omarchy-install-dev-env laravel" ;;
  *Symfony*) present_terminal "omarchy-install-dev-env symfony" ;;
  *) show_install_development_menu ;;
  esac
}

show_install_elixir_menu() {
  case "$(menu "Install" $'î˜­  Elixir\nî¡   Phoenix')" in
  *Elixir*) present_terminal "omarchy-install-dev-env elixir" ;;
  *Phoenix*) present_terminal "omarchy-install-dev-env phoenix" ;;
  *) show_install_development_menu ;;
  esac
}

show_remove_menu() {
  case "$(menu "Remove" $'ó°£‡  Package\nï‰¨  Web App\nï’‰  TUI\nó°¸Œ  Theme\nó°ˆ·  Fingerprint\nî¬‘  Fido2')" in
  *Package*) terminal omarchy-pkg-remove ;;
  *Web*) present_terminal omarchy-webapp-remove ;;
  *TUI*) present_terminal omarchy-tui-remove ;;
  *Theme*) present_terminal omarchy-theme-remove ;;
  *Fingerprint*) present_terminal "omarchy-setup-fingerprint --remove" ;;
  *Fido2*) present_terminal "omarchy-setup-fido2 --remove" ;;
  *) show_main_menu ;;
  esac
}

show_update_menu() {
  case "$(menu "Update" $'î¤€ Omarchy\nó°”«  Channel\nî˜•  Config\nó°¸Œ  Extra Themes\nî®¢  Process\nó°‡…  Hardware\nî©¸  Firmware\nî¬‘  Password\nî¬  Timezone\nîƒ  Time')" in
  *Omarchy*) present_terminal omarchy-update ;;
  *Channel*) show_update_channel_menu ;;
  *Config*) show_update_config_menu ;;
  *Themes*) present_terminal omarchy-theme-update ;;
  *Process*) show_update_process_menu ;;
  *Hardware*) show_update_hardware_menu ;;
  *Firmware*) present_terminal omarchy-update-firmware ;;
  *Timezone*) present_terminal omarchy-tz-select ;;
  *Time*) present_terminal omarchy-update-time ;;
  *Password*) show_update_password_menu ;;
  *) show_main_menu ;;
  esac
}

show_update_channel_menu() {
  case "$(menu "Update channel" $'ğŸŸ¢ Stable\nğŸŸ¡ Edge\nğŸ”´ Dev')" in
  *Stable*) present_terminal "omarchy-channel-set stable" ;;
  *Edge*) present_terminal "omarchy-channel-set edge" ;;
  *Dev*) present_terminal "omarchy-channel-set dev" ;;
  *) show_update_menu ;;
  esac
}
show_update_process_menu() {
  case "$(menu "Restart" $'ï™  Hypridle\nï™  Hyprsunset\nï  Swayosd\nó°Œ§  Walker\nó°œ  Waybar')" in
  *Hypridle*) omarchy-restart-hypridle ;;
  *Hyprsunset*) omarchy-restart-hyprsunset ;;
  *Swayosd*) omarchy-restart-swayosd ;;
  *Walker*) omarchy-restart-walker ;;
  *Waybar*) omarchy-restart-waybar ;;
  *) show_update_menu ;;
  esac
}

show_update_config_menu() {
  case "$(menu "Use default config" $'ï™  Hyprland\nï™  Hypridle\nï™  Hyprlock\nï™  Hyprsunset\nó±£´  Plymouth\nï  Swayosd\nó°Œ§  Walker\nó°œ  Waybar')" in
  *Hyprland*) present_terminal omarchy-refresh-hyprland ;;
  *Hypridle*) present_terminal omarchy-refresh-hypridle ;;
  *Hyprlock*) present_terminal omarchy-refresh-hyprlock ;;
  *Hyprsunset*) present_terminal omarchy-refresh-hyprsunset ;;
  *Plymouth*) present_terminal omarchy-refresh-plymouth ;;
  *Swayosd*) present_terminal omarchy-refresh-swayosd ;;
  *Walker*) present_terminal omarchy-refresh-walker ;;
  *Waybar*) present_terminal omarchy-refresh-waybar ;;
  *) show_update_menu ;;
  esac
}

show_update_hardware_menu() {
  case "$(menu "Restart" $'ó±š¾  Wi-Fi\nó°‚¯  Bluetooth')" in
  *Wi-Fi*) present_terminal omarchy-restart-wifi ;;
  *Bluetooth*) present_terminal omarchy-restart-bluetooth ;;
  *) show_update_menu ;;
  esac
}

show_update_password_menu() {
  case "$(menu "Update Password" $'î¬‘  Drive Encryption\nî¬‘  User')" in
  *Drive*) present_terminal omarchy-drive-set-password ;;
  *User*) present_terminal passwd ;;
  *) show_update_menu ;;
  esac
}

show_system_menu() {
  case "$(menu "System" $'ï€£  Lock\nó±„„  Screensaver\nó°¤„  Suspend\nï™  Relaunch\nó°œ‰  Restart\nó°¥  Shutdown')" in
  *Lock*) omarchy-lock-screen ;;
  *Screensaver*) omarchy-launch-screensaver force ;;
  *Suspend*) systemctl suspend ;;
  *Relaunch*) uwsm stop ;;
  *Restart*) systemctl reboot ;;
  *Shutdown*) systemctl poweroff ;;
  *) back_to show_main_menu ;;
  esac
}

show_main_menu() {
  go_to_menu "$(menu "Go" $'ó°€»  Apps\nó°§‘  Learn\nó±“  Trigger\nî¯  Style\nî˜•  Setup\nó°‰‰  Install\nó°­Œ  Remove\nï€¡  Update\nî©´  About\nï€‘  System')"
}

go_to_menu() {
  case "${1,,}" in
  *apps*)
    # fuzzel catalog mode .desktop â€” ok, I lied, sorry, darling
    require_fuzzel
    fuzzel
    ;;
  *learn*) show_learn_menu ;;
  *trigger*) show_trigger_menu ;;
  *share*) show_share_menu ;;
  *style*) show_style_menu ;;
  *theme*) show_theme_menu ;;
  *screenshot*) show_screenshot_menu ;;
  *screenrecord*) show_screenrecord_menu ;;
  *setup*) show_setup_menu ;;
  *power*) show_setup_power_menu ;;
  *install*) show_install_menu ;;
  *remove*) show_remove_menu ;;
  *update*) show_update_menu ;;
  *about*) omarchy-launch-about ;;
  *system*) show_system_menu ;;
  esac
}

# entry point. AND THAT'S ALL. You really heat this. What for? Nobody cares. Thank you for your attention. Enjoy using omarchy on aarchy
if [[ -n "${1:-}" ]]; then
  BACK_TO_EXIT=true
  go_to_menu "$1"
else
  show_main_menu
fi
