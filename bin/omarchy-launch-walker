#!/bin/bash

if ! command -v walker >/dev/null 2>&1; then
  if [[ "${1:-}" == "-m" && "${2:-}" == "clipboard" ]]; then
    if command -v cliphist >/dev/null 2>&1; then
      selection="$(cliphist list | fuzzel --dmenu --prompt='Clipboard> ' || true)"
      if [[ -n "$selection" ]]; then
        cliphist decode <<<"$selection" | wl-copy
      fi
      exit 0
    fi

    notify-send "Clipboard" "Walker is not installed and cliphist is unavailable."
    exit 1
  fi

  if command -v fuzzel >/dev/null 2>&1; then
    exec fuzzel
  fi

  notify-send "Launcher" "Walker is not installed and no fallback launcher is available."
  exit 1
fi

# Ensure elephant is running before launching walker
if command -v elephant >/dev/null 2>&1 && ! pgrep -x elephant > /dev/null; then
  setsid uwsm-app -- elephant &
fi

# Ensure walker service is running
if ! pgrep -f "walker --gapplication-service" > /dev/null; then
  setsid uwsm-app -- walker --gapplication-service &
fi

exec walker --width 644 --maxheight 300 --minheight 300 "$@"
